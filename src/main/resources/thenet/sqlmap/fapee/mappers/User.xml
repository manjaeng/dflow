<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.thenet.fapee.user.service.impl.UserMapper">
	
	<select id="selectUserList" resultType="userVO">
		SELECT *
		  FROM fp_user
	</select>
	
	<select id="selectUserInfo" resultType="userVO" parameterType="egovMap">
		SELECT idKey
		      ,userId
		      ,password
		      ,userType
		      ,mobile
		      ,email
		      ,lastLoginDate
		      ,joinDate
		      ,snsType
		      ,snsId
		      ,deviceId
		      ,status
		  FROM fp_user
		 WHERE 1 = 1
	 	<if test='idKey != null'>
	 		AND idKey = #{idKey}
	 	</if>
	 	<if test='userId != null'>
	 		AND userId = #{userId}
	 	</if>
	 	<if test='password != null'>
	 		AND password = #{password}
	 	</if>
	 	<if test='mobile != null'>
	 		AND mobile = #{mobile}
	 	</if>
	</select>
	
	<insert id="insertUserInfo" parameterType="userVO" useGeneratedKeys="true" keyProperty="idKey">
		INSERT into fp_user(
			 userId
			,password
			,userType
			,mobile
			,email,
			,lastLoginDate
			,joinDate
			,deviceId
			,status
		) VALUES (
			 #{userId}
			,#{password}
			,#{userType}
			,#{mobile}
			,#{email}
			,#{lastLoginDate}
			,now()
			,#{deviceId}
			,#{status}
		)
	</insert>
	
	<insert id="insertUserFilterInfo" parameterType="egovMap" useGeneratedKeys="true" keyProperty="idKey">
		INSERT into fp_user_filter(
			 deviceId
			,gender
			,country
		) VALUES (
			 #{deviceId}
			,#{gender}
			,#{country}
		)
	</insert>
	
	<insert id="insertUserStyleList" parameterType="egovMap">
		INSERT into fp_style_choose(
			 styleIdKey
			,userFilterIdKey
		) VALUES 
		<foreach collection="styleArray" item="item" index="i" separator=",">
			(#{item},#{userFilterIdKey})
       	</foreach>
		
	</insert>
	
	<update id="updateUserLastLoginInfo">
		UPDATE fp_user
		   SET lastLoginDate = now()
		 WHERE idKey = #{_parameter}   
	</update>
	
	<update id="updateUserFilterDeviceInfo" parameterType="userVO">
		UPDATE fp_user_filter
		   SET userIdKey = #{idKey}
		 WHERE deviceId = #{deviceId}
	</update>

	<insert id="insertUserProfileInfo" parameterType="userVO">
		INSERT into fp_user_profile(
			userIdKey
		   ,nickName
		) VALUES (
			#{idKey}
		   ,#{userId}
		)
	</insert>
	
	<update id="updateUserFilterCountryInfo" parameterType="egovMap">
		UPDATE fp_user_filter
		   SET country = #{country}
		 WHERE userIdKey = #{idKey}
	</update>
	
	<update id="updateUserInfo" parameterType="egovMap">
		UPDATE fp_user
		<trim prefix="SET" prefixOverrides=",">
			<if test="status != null">,status = #{status}</if>
			<if test="password != null">,password = #{password}</if>
		</trim>
		WHERE idKey = #{idKey}
	</update>
	
</mapper>