<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.thenet.fapee.user.service.impl.UserMapper">
	
	<select id="selectUserServiceInfo" resultType="FP_User" parameterType="egovMap">
		SELECT  idKey
		      , userId
		      , password
		      , userType
		      , userName
		      , mobileNumber
		      , email
		      , loginTotalCount
		      , loginFailCount
		      , lastLoginDate
		      , loginIp
		      , snsType
		      , snsId
		      , status
		  FROM FP_User
		 WHERE 1 = 1
		 <if test='type != null'>
		 	<if test='type == "id"'>
		 		AND userId = #{value}
		 	</if>
		 	 <if test='type == "email"'>
		 		AND email = #{value}
		 	</if>
		 </if>
	</select>
	
	<update id="updateUserServiceFailCount">
		UPDATE FP_User
		   SET loginFailCount=loginFailCount+1
		 WHERE idKey=#{_parameter}
	</update>
	
	<update id="updateUserServiceInfo" parameterType="FP_User">
		UPDATE FP_User
		   SET loginFailCount=0,
		       lastLoginDate=#{lastLoginDate},
		       loginTotalCount=#{loginTotalCount},
		       loginIp=#{loginIp}
		 WHERE idKey=#{idKey}
	</update>
	
	<select id="selectUserServiceList" resultType="FP_User">
		SELECT *
		  FROM FP_User
	</select>
	
	<select id="selectUserServiceCount" resultType="int" parameterType="FP_User">
		SELECT count(*)
		  FROM FP_User
		 WHERE userId = #{userId} OR email = #{email}
	</select>
	
	<insert id="insertUserServiceInfo" parameterType="FP_User">
		INSERT into FP_User(
			  idKey
			, userId
			, password
			, userType
			, email
			, loginTotalCount
			, loginFailCount
			, joinDate
		) VALUES (
			  #{idKey}
			, #{userId}
			, #{password}
			, 2
			, #{email}
			, 0
			, 0
			, now()
		)
	</insert>
	
</mapper>